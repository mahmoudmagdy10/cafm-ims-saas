<div class="card card-custom">
  <!-- begin::Header -->
  <div class="card-header card-header-stretch align-items-center">
    <div class="card-title m-0">
      <!-- https://www.svgrepo.com/svg/420196/lock-protect-security-15 -->
      <svg
        xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink"
        width="22px"
        height="22px"
        viewBox="0 0 512 512"
        id="Layer_1"
        style="enable-background: new 0 0 512 512"
        version="1.1"
        fill="#66a9ed"
        xml:space="preserve"
      >
        <g>
          <path
            class="st1"
            d="M481,120.1c-3.6,0.5-7.2,0.7-10.8,0.7c-34.9,0-64.9-21.2-77.8-51.4c-4.4-10.2-6.8-21.4-6.8-33.2   c0-2.8,0.1-5.5,0.4-8.2H126c0.3,2.7,0.4,5.4,0.4,8.2c0,11.8-2.4,23-6.8,33.2c-12.9,30.2-42.9,51.4-77.8,51.4   c-3.7,0-7.3-0.2-10.8-0.7c1.4,40-26,284.3,225,363.9C507,404.4,479.6,160.1,481,120.1z M416.2,291c-13.3,33.6-32.5,62.8-57.1,86.7   c-27.2,26.4-61.8,47.3-103.1,62c-41.3-14.7-75.9-35.6-103.1-62c-24.6-23.9-43.8-53.1-57.1-86.7C76.5,242.1,73,192.6,72.7,158.9   c37.8-9.5,69.7-36.1,85.5-73c2.2-5.2,4.1-10.5,5.6-15.9h184.5c1.5,5.4,3.4,10.8,5.6,16c15.8,36.9,47.7,63.5,85.5,73   C439,192.6,435.5,242.1,416.2,291z"
          />
          <path
            class="st0"
            d="M348.7,181.2l16.4-16.4c3.3-3.3,3.3-8.6,0-11.9l-19.6-19.6c-3.3-3.3-8.6-3.3-11.9,0l-16.4,16.4   c-11.6-7.7-24.8-13.2-38.9-16.1v-23.2c0-4.6-3.8-8.4-8.4-8.4h-27.8c-4.6,0-8.4,3.8-8.4,8.4v23.2c-14.1,2.9-27.3,8.4-38.9,16.1   l-16.4-16.4c-3.3-3.3-8.6-3.3-11.9,0l-19.6,19.6c-3.3,3.3-3.3,8.6,0,11.9l16.4,16.4c-7.7,11.6-13.3,24.8-16.1,38.9H124   c-4.6,0-8.4,3.8-8.4,8.4v27.8c0,4.6,3.8,8.4,8.4,8.4h23.2c2.9,14.1,8.4,27.3,16.1,38.9l-16.4,16.4c-3.3,3.3-3.3,8.6,0,11.9   l19.6,19.6c3.3,3.3,8.6,3.3,11.9,0l16.4-16.4c11.6,7.7,24.8,13.2,38.9,16.1v23.2c0,4.6,3.8,8.4,8.4,8.4h27.8c4.6,0,8.4-3.8,8.4-8.4   v-23.2c14.1-2.9,27.3-8.4,38.9-16.1l16.4,16.4c3.3,3.3,8.6,3.3,11.9,0l19.6-19.6c3.3-3.3,3.3-8.6,0-11.9l-16.4-16.4   c7.7-11.6,13.3-24.8,16.1-38.9H388c4.6,0,8.4-3.8,8.4-8.4v-27.8c0-4.7-3.8-8.4-8.4-8.4h-23.2C361.9,206,356.4,192.8,348.7,181.2z    M275.9,313.9v-33.9c13-7.1,21.9-20.9,21.9-36.8c0-17.1-10.3-31.9-25.1-38.3v37.4h-33.4V205c-14.8,6.4-25.1,21.2-25.1,38.3   c0,15.9,8.8,29.7,21.9,36.8v33.9c-31.4-8.7-54.4-37.5-54.4-71.6c0-41,33.3-74.3,74.3-74.3c41,0,74.3,33.3,74.3,74.3   C330.3,276.5,307.3,305.3,275.9,313.9z"
          />
        </g>
      </svg>
      <h4 class="fw-bolder mb-0 mx-2" *ngIf="!isSoftService">
        {{ "PM.CARD_HEADER" | translate }}
      </h4>
      <h4 class="fw-bolder mb-0 mx-2" *ngIf="isSoftService">
        {{ "SIDEBAR.CREATESOFTSERVICES" | translate }}
      </h4>
    </div>
    <div class="card-header-actions" *ngIf="CodeObz$ | async as codes">
      <div class="add-new-task">
        <!-- Balanced Redistribution
codes?.PagePermissions?.BalancedRedistribution-->
        <button
          *ngIf="viewType == 'FullCalender'"
          class="general-btn btn-info mx-1"
          (click)="BalancedRedistribution()"
        >
          <span>
            <span
              ><i class="fas fa-balance-scale fa-lg" style="color: #ffffff"></i
            ></span>
            <span>{{ "Balanced Redistribution" | translate }}</span>
          </span>
        </button>
        <button class="general-btn filter-btn mx-1" (click)="Filter()">
          <span>
            <span><i class="fas fa-filter"></i></span>
            <span>{{ "PREVENTIVE_TASKS_MANAGEMENT.FILTER" | translate }}</span>
          </span>
        </button>

        <button
          *ngIf="codes?.PagePermissions?.PMAdd"
          class="general-btn add-btn mx-1"
          (click)="addPMTask()"
        >
          <span>
            <span><i class="fas fa-plus"></i></span>
            <span>{{ "PM.ADD_PM" | translate }}</span>
          </span>
        </button>
        <button
          *ngIf="codes?.PagePermissions?.PMExport && viewType == 'List'"
          class="btn btn-success mx-1"
          (click)="export()"
        >
          <span>
            <i class="fas fa-upload fa-lg"></i>

            {{ "ASSETS.ACTIONSONSELECTEDMENU.EXPORTDATA" | translate }}
          </span>
        </button>
        <button
          *ngIf="codes?.PagePermissions?.PMPrint && viewType == 'List'"
          type="button"
          class="general-btn filter-btn mx-1"
          data-bs-dismiss="modal"
          (click)="weeklyPrint()"
        >
          <span>
            <span> <i class="fas fa-print fa-lg"></i> </span>
            <span> {{ "GENERAL.PRINT" | translate }} </span>
          </span>
        </button>

        <button
          [disabled]="WorkOrderSelected.length == 0"
          *ngIf="viewType !== 'List' && viewType !== 'FullCalender'"
          type="button"
          class="btn btn-sm btn-info"
          data-bs-dismiss="modal"
          (click)="print()"
        >
          <div
            *ngIf="loadingPrint"
            class="spinner-border text-dark"
            style="width: 10px; height: 10px"
            role="status"
          >
            <span class="sr-only">Loading...</span>
          </div>
          <span> <i class="fas fa-print fa-lg"></i> </span>

          <span> {{ "GENERAL.PRINT_SELECTED" | translate }} </span>
        </button>
        <!-- <button
          *ngIf="codes?.PagePermissions?.PMAdd"
          type="button"
          class="btn btn-sm btn-light"
          data-bs-dismiss="modal"
          (click)="print()"
        >
          <div
            *ngIf="loadingPrint"
            class="spinner-border text-dark mx-1"
            style="width: 10px; height: 10px"
            role="status"
          >
            <span class="sr-only">Loading...</span>
          </div>
          <span>
            <span> <i class="fas fa-print fa-lg"></i> </span>
            <span> {{ "GENERAL.PRINT_SELECTED" | translate }} </span>
          </span>
        </button> -->
      </div>
    </div>
  </div>
  <!-- end::Header -->
  <!-- begin::Body -->

  <div class="card-body" #Report>
    <div class="row mb-3">
      <div class="col-12" style="text-align: end">
        <span>
          {{ "Total" | translate }}
        </span>
        <span class="fs-1 margin-end-1">:</span>
        <a href="javascript:;" *ngIf="viewType == 'List'">{{
          ((pmsData$|async)?.Setting?.[0]?.TotalCount) || 0
        }}</a>
        <a href="javascript:;" *ngIf="viewType == 'FullCalender'">{{
          ((AllSchedulesTimeCalender$|async)?.Setting?.[0]?.TotalCount) || 0
        }}</a>
        <a href="javascript:;" *ngIf="viewType == 'DailyPm'">{{
          ((AllSchedulesTimeCalender$|async)?.Setting?.[0]?.TotalCount) || 0
        }}</a>
        |
        <span>
          {{ "PREVENTIVE_TASKS_MANAGEMENT.DISPLAY_AS.DISPLAY_AS" | translate }}
        </span>
        <span class="fs-1 margin-end-1">:</span>

        <a href="javascript:;" (click)="viewType = 'List'">{{
          "PREVENTIVE_TASKS_MANAGEMENT.DISPLAY_AS.DISPLAY_AS_LIST" | translate
        }}</a>
        |
        <a href="javascript:;" (click)="viewType = 'FullCalender'">
          {{
            "PREVENTIVE_TASKS_MANAGEMENT.DISPLAY_AS.DISPLAY_AS_CALENDAR"
              | translate
          }}
        </a>
        |
        <a
          href="javascript:;"
          [class]="viewType == 'DailyPm' ? 'active' : ''"
          (click)="viewType = 'DailyPm'"
          >{{ "DailyWo" | translate }}</a
        >
      </div>
    </div>
    <app-view-data-filter [componentType]="'PPM'"></app-view-data-filter>
    <div class="mt-3"></div>
    <ng-container *ngIf="viewType == 'List'">
      <app-view-table
        (openCard)="Card($event)"
        (openCardTabUpComing)="Card($event, true)"
      ></app-view-table>
    </ng-container>
    <ng-container *ngIf="viewType == 'FullCalender'">
      <ng-container *ngIf="CodeObz$ | async as codes">
        <app-view-calender
          [permissions]="codes"
          (openCard)="Card($event, undefined, true)"
        ></app-view-calender>
      </ng-container>
    </ng-container>
    <ng-container *ngIf="viewType == 'DailyPm'">
      <according-to-created-date-pms
        (openCard)="Card($event, undefined, true)"
      ></according-to-created-date-pms>
    </ng-container>
  </div>
</div>

<!-- end::Body -->

<!-- begin::Footer -->

<!-- end::Footer -->
<table
  #TABLE
  [hidden]="true"
  class="table table-rounded table-row-bordered border custom-table-style vertical-align-middle fs-6"
>
  <thead>
    <tr class="fw-bolder fs-6 text-gray-800">
      <th>#</th>
      <th>{{ "PM.TABLE.PM_NAME" | translate }}</th>
      <th>{{ "PM.TABLE.ASSET" | translate }}</th>
      <th>
        {{ "PREVENTIVE_TASKS_MANAGEMENT.PRIORITY_LEVEL" | translate }}
      </th>

      <th class="text-center">{{ "PM.TABLE.SCHEDULES" | translate }}</th>
      <th>{{ "PM.TABLE.ASSIGNED_TO" | translate }}</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let item of pmsExcel$ | async; index as i">
      <td>
        <span>{{ i + 1 }}</span>
      </td>
      <td>
        <a href="javascript:;">
          {{ item.TaskName }}
        </a>
      </td>
      <td>{{ item.AssetName }}</td>
      <td>
        <!-- <i
          class="fa fa-info-circle fa-lg"
          [style]="{ color: item?.PriorityColor }"
          [pTooltip]="item.PriorityName"
        ></i> -->
        {{ item.PriorityName }}
      </td>

      <td class="text-center">
        <i
          [class]="
            item.PMSchedules
              ? 'far fa-calendar-alt fa-lg text-success cursor-pointer'
              : 'far fa-calendar-alt fa-lg text-danger cursor-pointer'
          "
        ></i>
        {{ item.PMSchedules?.length }}
      </td>
      <td>
        {{ ArrayToString(item.TaskAssignmentTeamTxt) }}
        {{ ArrayToString(item.TaskAssignmentUserTxt) }}
      </td>
    </tr>
  </tbody>
</table>
